# 医疗多智能体辩论系统

这是一个基于LangGraph的医疗多智能体辩论系统，用于乳腺癌诊疗决策支持。

## 功能特点

1. **四个RAG智能体**：每个智能体基于不同的专业文献库生成判断
   - 21-Gene专家：基于21基因检测相关文献
   - 靶向治疗专家：基于靶向治疗相关文献
   - 化疗专家：基于化疗相关文献
   - 内分泌治疗专家：基于内分泌治疗相关文献

2. **辩论组织智能体**：组织四个专家进行辩论，最多3轮，直到达成一致意见

3. **最终回答生成**：基于辩论结果生成综合、专业的最终回答

## 系统架构

```
用户问题
    ↓
四个RAG智能体并行生成回答
    ↓
辩论组织者检查共识
    ↓
未达成一致 → 继续辩论（最多3轮）
    ↓
达成一致 → 生成最终回答
```

## 使用方法

### 1. 环境要求

- Python 3.8+
- 已部署的sglang服务：
  - qwen3-8B LLM服务，API地址：http://0.0.0.0:30003
  - Qwen3-Embedding-8B Embedding服务，API地址：http://0.0.0.0:30004
- 所需的Python包（见requirements.txt）

### 2. 安装依赖

```bash
pip install langchain langchain-openai langgraph faiss-cpu numpy
```

### 3. 运行系统

```bash
cd debat
python run_debate.py
```

或者直接运行主文件：

```bash
python medical_debate_system.py
```

## 文件结构

```
debat/
├── medical_debate_system.py  # 主系统文件
├── run_debate.py            # 运行脚本
└── README.md                # 说明文档
```

## 工作流程

1. **初始化阶段**：
   - 从四个文献目录加载文档（21-Gene、靶向治疗、化疗、内分泌治疗）
   - 为每个文献库创建向量数据库
   - 创建四个RAG智能体和一个辩论组织智能体

2. **第一轮辩论**：
   - 四个RAG智能体并行生成初始回答
   - 辩论组织者检查是否达成一致

3. **后续轮次**（如需要）：
   - 如果未达成一致且未达到最大轮次（3轮），继续辩论
   - 智能体基于辩论历史重新生成回答
   - 辩论组织者再次检查共识

4. **生成最终回答**：
   - 达成一致或达到最大轮次后，生成最终综合回答

## 注意事项

1. 确保sglang服务已启动并运行在 http://0.0.0.0:30004
2. 确保文献数据目录存在且包含.txt文件
3. 首次运行时会创建向量数据库，可能需要一些时间
4. 辩论最多进行3轮，第3轮后强制达成一致

## 配置说明

可以在代码中修改以下配置：

- `base_url`: LLM API地址（默认：http://0.0.0.0:30003/v1）
- `model_name`: LLM模型名称（默认：qwen3-8B）
- `embedding_api_url`: Embedding API地址（默认：http://0.0.0.0:30004/v1）
- `embedding_model`: Embedding模型名称（默认：Qwen3-Embedding-8B）
- `chunk_size`: 文档分块大小（默认：1000）
- `chunk_overlap`: 文档分块重叠（默认：200）
- `max_debate_rounds`: 最大辩论轮次（默认：3）

## 输出说明

系统会输出：
1. 各专家的初始观点
2. 辩论历史（每轮的共识分析）
3. 最终综合回答

最终回答会综合所有专家的观点，突出共识部分，并说明不同观点的依据和适用情况。
